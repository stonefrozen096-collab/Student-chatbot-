<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moderator Dashboard</title>
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/animation.css">
  <link rel="stylesheet" href="css/moderator.css">
</head>
<body>
  <header>
    <h1>Moderator Dashboard</h1>
    <p>Monitor system activities and login attempts</p>
  </header>

  <main>
    <!-- Logs Table -->
    <section class="logs-section">
      <h2>Activity Logs</h2>
      <input type="text" id="searchLogs" placeholder="Search logs..." class="search-bar">
      <table id="logsTable">
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>User</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- Logs populated via JS -->
        </tbody>
      </table>
    </section>

    <!-- Alerts Section -->
    <section class="alerts-section">
      <h2>Unauthorized Access Attempts</h2>
      <ul id="alertsList">
        <!-- Alerts populated via JS -->
      </ul>
    </section>
  </main>

  <script>
    async function loadLogs() {
      try {
        const res = await fetch('/logs'); // endpoint to fetch logs
        const data = await res.json();
        const tableBody = document.querySelector('#logsTable tbody');
        tableBody.innerHTML = '';
        data.forEach(log => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${new Date(log.timestamp).toLocaleString()}</td>
                          <td>${log.user}</td>
                          <td>${log.action}</td>`;
          tableBody.appendChild(tr);
        });
      } catch(err) {
        console.error("Failed to load logs", err);
      }
    }

    async function loadAlerts() {
      try {
        const res = await fetch('/alerts'); // endpoint for unauthorized access attempts
        const data = await res.json();
        const alertsList = document.getElementById('alertsList');
        alertsList.innerHTML = '';
        data.forEach(alert => {
          const li = document.createElement('li');
          li.textContent = `${new Date(alert.timestamp).toLocaleString()} - ${alert.user}: ${alert.action}`;
          alertsList.appendChild(li);
        });
      } catch(err) {
        console.error("Failed to load alerts", err);
      }
    }

    // Search logs
    document.getElementById('searchLogs').addEventListener('input', function() {
      const filter = this.value.toLowerCase();
      document.querySelectorAll('#logsTable tbody tr').forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
      });
    });

    // Load data on page load
    loadLogs();
    loadAlerts();

    // Optional: auto-refresh every 30 seconds
    setInterval(() => {
      loadLogs();
      loadAlerts();
    }, 30000);
  </script>
</body>
</html>