<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<link rel="stylesheet" href="Admin.css">
<link rel="stylesheet" href="Animation.css">
<style>
/* Basic Admin Dashboard Styles */
body { font-family: 'Segoe UI', sans-serif; background:#1e1e2f; color:white; margin:0; }
header { background:#2e2e4f; padding:12px 20px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.6em; }
nav button { margin-left:8px; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; background:#4f46e5; color:white; transition:0.3s; }
nav button:hover { background:#6366f1; }
.admin-section { display:none; padding:20px; animation:fadeIn 0.6s ease; }
.list { margin-top:10px; max-height:400px; overflow-y:auto; border:1px solid rgba(255,255,255,0.1); border-radius:8px; padding:10px; background:#292946; }
.btn { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; background:#4f46e5; color:white; transition:0.3s; }
.btn:hover { background:#6366f1; }
.tiny { padding:3px 8px; font-size:0.85em; }
</style>
</head>
<body>

<header>
  <h1>Admin Dashboard</h1>
  <nav>
    <button onclick="showSection('users')">Users</button>
    <button onclick="showSection('badges')">Badges</button>
    <button onclick="showSection('attendance')">Attendance</button>
    <button onclick="showSection('tests')">Tests</button>
    <button onclick="showSection('master')">Master Commands</button>
    <button onclick="showSection('triggers')">Triggers</button>
    <button onclick="showSection('notice')">Notices</button>
  </nav>
</header>

<div id="content">
  <!-- All sections will appear here -->
</div>

<script>
function showSection(id){
  const sections = document.querySelectorAll('.admin-section');
  sections.forEach(sec => sec.style.display='none');
  const s = document.getElementById(id);
  if(s) s.style.display='block';
}
</script>

</body>
</html>
<!-- USERS SECTION -->
<div id="users" class="admin-section">
  <h2>User Management</h2>
  <form id="addUserForm">
    <label>Name:</label>
    <input type="text" id="userName" required placeholder="Full Name">
    <label>Username:</label>
    <input type="text" id="userUsername" required placeholder="Username">
    <label>Role:</label>
    <select id="userRole">
      <option value="student">Student</option>
      <option value="faculty">Faculty</option>
      <option value="moderator">Moderator</option>
      <option value="tester">Tester</option>
    </select>
    <label id="passwordLabel" style="display:none">Password:</label>
    <input type="password" id="userPassword" style="display:none;" placeholder="Set Password for Faculty">
    <button type="submit">Add User</button>
  </form>

  <div id="userList" class="list"></div>
</div>

<script>
const users = JSON.parse(localStorage.getItem('users') || '[]');

/* Show/Hide password field for Faculty */
document.getElementById('userRole').addEventListener('change', e=>{
  const pw = document.getElementById('userPassword');
  const label = document.getElementById('passwordLabel');
  if(e.target.value==='faculty'){
    pw.style.display='block'; 
    label.style.display='block';
  } else {
    pw.style.display='none'; 
    label.style.display='none';
  }
});

/* Render Users List */
function renderUsers(){
  const ul = document.getElementById('userList'); 
  ul.innerHTML='';
  users.forEach((u,i)=>{
    const div = document.createElement('div');
    div.innerHTML=`<strong>${u.name}</strong> (${u.username}) - ${u.role} 
      <button class="btn tiny" onclick="deleteUser(${i})">Delete</button>`;
    ul.appendChild(div);
  });
}

/* Add User */
document.getElementById('addUserForm').addEventListener('submit', e=>{
  e.preventDefault();
  const name = document.getElementById('userName').value.trim();
  const username = document.getElementById('userUsername').value.trim();
  const role = document.getElementById('userRole').value;
  const password = document.getElementById('userPassword').value.trim();
  const user = {name, username, role};
  if(role==='faculty') user.password=password;
  users.push(user);
  localStorage.setItem('users', JSON.stringify(users));
  renderUsers();
  e.target.reset();
});

/* Delete User */
function deleteUser(i){
  if(!confirm('Delete user?')) return;
  users.splice(i,1);
  localStorage.setItem('users', JSON.stringify(users));
  renderUsers();
}

/* Initialize */
renderUsers();
</script>
<!-- BADGES SECTION -->
<div id="badges" class="admin-section">
  <h2>Badge Management</h2>

  <!-- Create Badge -->
  <form id="addBadgeForm">
    <label>Badge Name:</label>
    <input type="text" id="badgeName" placeholder="Badge Name" required>

    <label>Effects:</label>
    <select id="badgeEffects" multiple>
      <option value="highlight">Highlight</option>
      <option value="special-access">Special Access</option>
      <option value="priority">Priority</option>
      <option value="glow">Glow</option>
    </select>

    <button type="submit">Create Badge</button>
  </form>

  <!-- Badge List -->
  <div id="badgeList" class="list"></div>

  <!-- Assign Badge to Users -->
  <h3>Assign Badge to User</h3>
  <select id="assignBadgeUser"><option value="">Select User</option></select>
  <select id="assignBadgeSelect"><option value="">Select Badge</option></select>
  <button onclick="assignBadge()">Assign Badge</button>
</div>

<script>
const badges = JSON.parse(localStorage.getItem('badges') || '[]');

/* Create Badge */
document.getElementById('addBadgeForm').addEventListener('submit', e=>{
  e.preventDefault();
  const name = document.getElementById('badgeName').value.trim();
  const effects = Array.from(document.getElementById('badgeEffects').selectedOptions).map(o=>o.value);
  if(!name || effects.length===0){ alert('Enter badge name and select effects'); return; }
  badges.push({name,effects});
  localStorage.setItem('badges', JSON.stringify(badges));
  renderBadges();
  e.target.reset();
});

/* Render Badge List */
function renderBadges(){
  const div = document.getElementById('badgeList'); 
  div.innerHTML='';
  badges.forEach((b,i)=>{
    const d = document.createElement('div');
    d.innerHTML=`<strong>${b.name}</strong> [${b.effects.join(', ')}] 
      <button class="btn tiny" onclick="deleteBadge(${i})">Delete</button>`;
    div.appendChild(d);
  });
  updateAssignBadgeSelect();
}

/* Delete Badge */
function deleteBadge(i){
  if(!confirm('Delete badge?')) return;
  badges.splice(i,1);
  localStorage.setItem('badges', JSON.stringify(badges));
  renderBadges();
}

/* Update Assign Dropdowns */
function updateAssignBadgeUser(){
  const sel = document.getElementById('assignBadgeUser');
  sel.innerHTML='<option value="">Select User</option>';
  users.forEach(u=>{
    sel.insertAdjacentHTML('beforeend',`<option value="${u.username}">${u.name} (${u.username})</option>`);
  });
}
function updateAssignBadgeSelect(){
  const sel = document.getElementById('assignBadgeSelect');
  sel.innerHTML='<option value="">Select Badge</option>';
  badges.forEach(b=>{
    sel.insertAdjacentHTML('beforeend',`<option value="${b.name}">${b.name}</option>`);
  });
}

/* Assign Badge */
function assignBadge(){
  const user = document.getElementById('assignBadgeUser').value;
  const badge = document.getElementById('assignBadgeSelect').value;
  if(!user || !badge){ alert('Select user & badge'); return; }
  alert(`Badge "${badge}" assigned to ${user}`);
}

/* Initialize */
renderBadges();
updateAssignBadgeUser();
</script>
<!-- BADGE ASSIGNMENT CONTINUED -->
<h3>Assign Badge to User</h3>
<select id="assignBadgeUser"><option value="">Select User</option></select>
<select id="assignBadgeSelect"><option value="">Select Badge</option></select>
<button onclick="assignBadgeToUser()">Assign Badge</button>

<script>
/* ---------- ASSIGN BADGE FUNCTION ---------- */
function assignBadgeToUser(){
  const username = document.getElementById('assignBadgeUser').value;
  const badgeName = document.getElementById('assignBadgeSelect').value;
  if(!username || !badgeName) return alert('Select both user and badge');

  // Find user and badge
  const user = users.find(u => u.username === username);
  const badge = badges.find(b => b.name === badgeName);
  if(!user || !badge) return alert('Invalid selection');

  // Assign badge to user (add effects as well)
  user.badges = user.badges || [];
  const alreadyAssigned = user.badges.find(b => b.name === badgeName);
  if(alreadyAssigned){
    alert('User already has this badge');
    return;
  }
  user.badges.push({name: badge.name, effects: badge.effects});
  
  // Save users to JSON (or localStorage for testing)
  saveUsers();
  alert(`Badge "${badgeName}" assigned to ${user.name}`);
  renderUsers();
}

/* Update assign user & badge selects dynamically */
function updateAssignBadgeUser(){
  const sel = document.getElementById('assignBadgeUser');
  sel.innerHTML = '<option value="">Select User</option>';
  users.forEach(u => sel.insertAdjacentHTML('beforeend', `<option value="${u.username}">${u.name} (${u.role})</option>`));
}

function updateAssignBadgeSelect(){
  const sel = document.getElementById('assignBadgeSelect');
  sel.innerHTML = '<option value="">Select Badge</option>';
  badges.forEach(b => sel.insertAdjacentHTML('beforeend', `<option value="${b.name}">${b.name}</option>`));
}

// Initial render
renderUsers(); 
renderBadges();
updateAssignBadgeUser();
updateAssignBadgeSelect();
</script>
<!-- TEST CREATION SECTION -->
<div id="tests" class="admin-section" style="display:none;">
  <h2>Create Test</h2>
  <form id="createTestForm">
    <label>Test Type:</label>
    <select id="testTypeSelect">
      <option value="mcq">MCQ</option>
      <option value="short">Short Answer</option>
    </select>
    <label>Subject:</label>
    <input type="text" id="testSubject" required>
    <label>Question:</label>
    <textarea id="testQuestion" required></textarea>

    <!-- MCQ Options -->
    <div id="mcqOptionsContainer" style="display:none;">
      <label>Options:</label>
      <div id="mcqOptionsList"></div>
      <button type="button" onclick="addMCQOption()">Add Option</button>
      <label>Correct Option:</label>
      <select id="correctOptionSelect"></select>
    </div>

    <!-- Assign to student -->
    <label>Assign to Student:</label>
    <select id="assignTestStudent">
      <option value="">All Students</option>
    </select>

    <button type="submit">Create & Publish Test</button>
  </form>

  <h3>Existing Tests</h3>
  <div id="testList"></div>
</div>

<script>
const createdTests = JSON.parse(localStorage.getItem('createdTests')||'[]');
const testStudentsSelect = document.getElementById('assignTestStudent');
const mcqContainer = document.getElementById('mcqOptionsContainer');
const mcqOptionsList = document.getElementById('mcqOptionsList');
const correctOptionSelect = document.getElementById('correctOptionSelect');

// Toggle MCQ options
document.getElementById('testTypeSelect').addEventListener('change', e => {
  mcqContainer.style.display = e.target.value === 'mcq' ? 'block' : 'none';
  mcqOptionsList.innerHTML = '';
  correctOptionSelect.innerHTML = '';
});

// Populate student dropdown
function updateTestStudentSelect() {
  testStudentsSelect.innerHTML = '<option value="">All Students</option>';
  users.filter(u=>u.role==='student').forEach(s => {
    testStudentsSelect.insertAdjacentHTML('beforeend', `<option value="${s.username}">${s.name}</option>`);
  });
}

// Add MCQ option
function addMCQOption() {
  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = 'Option text';
  input.oninput = updateCorrectOptions;
  mcqOptionsList.appendChild(input);
  updateCorrectOptions();
}

// Update correct option dropdown
function updateCorrectOptions() {
  correctOptionSelect.innerHTML = '';
  Array.from(mcqOptionsList.children).forEach((opt, i) => {
    if(opt.value.trim()) correctOptionSelect.insertAdjacentHTML('beforeend', `<option value="${opt.value.trim()}">${opt.value.trim()}</option>`);
  });
}

// Render existing tests
function renderTests() {
  const list = document.getElementById('testList');
  list.innerHTML = '';
  createdTests.forEach((t, i) => {
    const div = document.createElement('div');
    div.innerHTML = `<strong>[${t.type.toUpperCase()}]</strong> ${t.subject} 
      <div>Question: ${t.question}</div>
      ${t.type==='mcq'?`<div>Options: ${t.options.join(', ')} | Answer: ${t.answer}</div>`:''}
      <div>Assigned to: ${t.student || 'All'}</div>
      <button onclick="deleteTest(${i})">Delete</button>`;
    list.appendChild(div);
  });
}

// Delete test
function deleteTest(index) {
  if(!confirm('Delete this test?')) return;
  createdTests.splice(index,1);
  localStorage.setItem('createdTests', JSON.stringify(createdTests));
  renderTests();
}

// Handle form submission
document.getElementById('createTestForm').addEventListener('submit', e=>{
  e.preventDefault();
  const type = document.getElementById('testTypeSelect').value;
  const subject = document.getElementById('testSubject').value.trim();
  const question = document.getElementById('testQuestion').value.trim();
  const student = document.getElementById('assignTestStudent').value;

  let test = {id:'test_'+Date.now(), type, subject, question, student};

  if(type==='mcq'){
    const options = Array.from(mcqOptionsList.children).map(o=>o.value.trim()).filter(Boolean);
    const answer = correctOptionSelect.value;
    if(options.length<2 || !answer) return alert('Add valid MCQ options and select correct answer');
    test.options = options;
    test.answer = answer;
  }

  createdTests.push(test);
  localStorage.setItem('createdTests', JSON.stringify(createdTests));
  renderTests();
  e.target.reset();
  mcqOptionsList.innerHTML = '';
  correctOptionSelect.innerHTML = '';
});

updateTestStudentSelect();
renderTests();
</script>
<!-- NOTICE SECTION -->
<div id="notices" class="admin-section" style="display:none;">
  <h2>Notice Management</h2>
  <form id="addNoticeForm">
    <label>Title:</label><input type="text" id="noticeTitle" required>
    <label>Content:</label><textarea id="noticeContent" required></textarea>
    <label>Assign To:</label>
    <select id="noticeAssign">
      <option value="">All Students</option>
    </select>
    <button type="submit">Post Notice</button>
  </form>

  <h3>Existing Notices</h3>
  <div id="noticeList"></div>
</div>

<!-- PROFILE MANAGEMENT SECTION -->
<div id="profiles" class="admin-section" style="display:none;">
  <h2>Profile Management</h2>
  <label>Search User:</label>
  <input type="text" id="searchProfile" placeholder="Enter name or username">
  <div id="profileList"></div>
</div>

<script>
const notices = JSON.parse(localStorage.getItem('notices')||'[]');

// Populate student dropdown for notice assign
function updateNoticeAssign() {
  const sel = document.getElementById('noticeAssign');
  sel.innerHTML = '<option value="">All Students</option>';
  users.filter(u=>u.role==='student').forEach(s => {
    sel.insertAdjacentHTML('beforeend', `<option value="${s.username}">${s.name}</option>`);
  });
}

// Render existing notices
function renderNotices() {
  const list = document.getElementById('noticeList');
  list.innerHTML = '';
  notices.forEach((n, i)=>{
    const div = document.createElement('div');
    div.innerHTML = `<strong>${n.title}</strong> - ${n.content}<div>Assigned to: ${n.student || 'All'}</div>
      <button onclick="deleteNotice(${i})">Delete</button>`;
    list.appendChild(div);
  });
}

// Delete notice
function deleteNotice(i){
  if(!confirm('Delete this notice?')) return;
  notices.splice(i,1);
  localStorage.setItem('notices', JSON.stringify(notices));
  renderNotices();
}

// Add notice
document.getElementById('addNoticeForm').addEventListener('submit', e=>{
  e.preventDefault();
  const title = document.getElementById('noticeTitle').value.trim();
  const content = document.getElementById('noticeContent').value.trim();
  const student = document.getElementById('noticeAssign').value;
  if(!title || !content) return alert('Enter both title and content');
  notices.push({title, content, student});
  localStorage.setItem('notices', JSON.stringify(notices));
  renderNotices();
  e.target.reset();
});

// ---------- PROFILE MANAGEMENT ----------
function renderProfiles() {
  const list = document.getElementById('profileList');
  const query = document.getElementById('searchProfile').value.trim().toLowerCase();
  list.innerHTML = '';
  users.filter(u => u.name.toLowerCase().includes(query) || u.username.toLowerCase().includes(query))
       .forEach(u=>{
         const div = document.createElement('div');
         div.innerHTML = `<strong>${u.name} (${u.username})</strong> - ${u.role} 
           <button onclick="editProfile('${u.username}')">Edit</button>`;
         list.appendChild(div);
       });
}

// Edit profile
function editProfile(username){
  const user = users.find(u=>u.username===username);
  if(!user) return;
  const newName = prompt('Name', user.name);
  if(newName!==null) user.name=newName;
  if(user.role==='faculty'){
    const newPw = prompt('Password', user.password||'');
    if(newPw!==null) user.password=newPw;
  }
  saveUsers(); renderProfiles();
}

// Search event
document.getElementById('searchProfile').addEventListener('input', renderProfiles);

updateNoticeAssign();
renderNotices();
renderProfiles();
</script>
<!-- MASTER COMMANDS SECTION -->
<div id="masterCommandsSection" class="admin-section animated-card">
  <h2>Master Commands</h2>
  <form id="masterCommandForm" class="form-card">
    <input type="text" id="masterCommandName" placeholder="Command Name e.g. Lock All" required>
    <textarea id="masterCommandAction" placeholder="JS Code to execute" required></textarea>
    <button type="submit" class="btn btn-primary">Add Command</button>
  </form>
  <div id="masterCommandsList" class="list animated-list"></div>
</div>

<!-- TRIGGERS SECTION -->
<div id="triggersSection" class="admin-section animated-card">
  <h2>Chatbot Triggers</h2>
  <form id="triggerForm" class="form-card">
    <input type="text" id="triggerInput" placeholder="Trigger Word/Phrase" required>
    <input type="text" id="triggerResponse" placeholder="Response for trigger" required>
    <button type="submit" class="btn btn-primary">Add Trigger</button>
  </form>
  <div id="triggersList" class="list animated-list"></div>
</div>
