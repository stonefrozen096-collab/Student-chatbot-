<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/animation.css">
<style>
body {
  background: #f4f6f9;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 0;
}

#bg-canvas {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  z-index: 0;
  pointer-events: none;
  background: linear-gradient(120deg, #0f172a 0%, #0b1320 50%, #061026 100%);
  opacity: 0.4;
}

.container {
  position: relative;
  z-index: 2;
  max-width: 1200px;
  margin: 50px auto;
  padding: 20px;
}

.profile-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 20px;
  display: flex;
  gap: 20px;
  align-items: center;
  margin-bottom: 25px;
}

.profile-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: #4f46e5;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 28px;
  font-weight: bold;
  flex-shrink: 0;
}

.profile-info h2 {
  margin: 0;
  font-size: 22px;
  color: #0f172a;
}

.profile-info p {
  margin: 4px 0;
  color: #475569;
  font-size: 14px;
}

.badge-container {
  margin-top: 10px;
}

.badge {
  display: inline-block;
  padding: 5px 12px;
  border-radius: 12px;
  margin: 3px;
  font-size: 12px;
  font-weight: 600;
  animation: pop 0.3s ease forwards;
  cursor: default;
}

.badge.admin { background-color: #e74c3c; color: #fff; }
.badge.moderator { background-color: #8b5cf6; color: #fff; }
.badge.tester { background-color: #f59e0b; color: #fff; }
.badge.faculty { background-color: #3b82f6; color: #fff; }
.badge.student { background-color: #2ecc71; color: #fff; }

@keyframes pop {
  0% { transform: scale(0.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

.section-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  padding: 20px;
  margin-bottom: 20px;
}

.section-card h3 {
  margin-top: 0;
  color: #2563eb;
}

.logout-btn {
  padding: 8px 15px;
  border: none;
  background: #ef4444;
  color: #fff;
  border-radius: 8px;
  cursor: pointer;
  float: right;
  font-weight: bold;
}

input, select, textarea {
  width: 100%;
  margin-bottom: 12px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  outline: none;
}

button.primary-btn {
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(90deg, #4f46e5, #3b82f6);
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}

button.primary-btn:hover {
  transform: scale(1.03);
}

.user-list, .attendance-list, .feedback-list, .academic-list {
  max-height: 300px;
  overflow-y: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 15px;
}

table th, table td {
  padding: 8px;
  text-align: left;
  border-bottom: 1px solid #e5e7eb;
}

table th {
  background: #f3f4f6;
}
</style>
</head>
<body>
<canvas id="bg-canvas" aria-hidden="true"></canvas>

<div class="container">
  <!-- Admin Profile with Editable Info -->
  <div class="profile-card">
    <div class="profile-avatar" id="adminAvatar">A</div>
    <div class="profile-info">
      <h2 id="adminName">Admin Name</h2>
      <p><strong>Email:</strong> <span id="adminEmail">admin@example.com</span></p>
      <div class="badge-container" id="adminBadges">
        <span class="badge admin">ADMIN</span>
      </div>
      <button class="primary-btn" onclick="toggleEditAdmin()">Edit Profile</button>
      <div id="editAdminSection" style="display:none; margin-top:10px;">
        <input type="text" id="editAdminName" placeholder="Enter Admin Name">
        <input type="email" id="editAdminEmail" placeholder="Enter Email">
        <input type="password" id="editAdminPassword" placeholder="Enter New Password (optional)">
        <button class="primary-btn" onclick="saveAdminInfo()">Save</button>
      </div>
    </div>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <!-- User Management -->
  <div class="section-card">
    <h3>User Management</h3>
    <form id="createUserForm">
      <label for="role">Role:</label>
      <select id="role" required>
        <option value="admin">Admin</option>
        <option value="moderator">Moderator</option>
        <option value="tester">Tester</option>
        <option value="faculty">Faculty</option>
        <option value="student">Student</option>
      </select>

      <label for="username">Username / Email / Reg No:</label>
      <input type="text" id="username" placeholder="Enter username or reg no" required>

      <label for="password">Password (if applicable):</label>
      <input type="password" id="password" placeholder="Password">

      <button type="submit" class="primary-btn">Create User</button>
    </form>

    <div class="user-list" id="userList">
      <!-- Populated dynamically -->
    </div>
  </div>

  <!-- Badges Management -->
  <div class="section-card">
    <h3>Badges</h3>
    <form id="badgeForm">
      <label for="badgeUser">Select User:</label>
      <select id="badgeUser"></select>

      <label for="badgeRole">Assign Badge:</label>
      <select id="badgeRole">
        <option value="admin">Admin</option>
        <option value="moderator">Moderator</option>
        <option value="tester">Tester</option>
        <option value="faculty">Faculty</option>
        <option value="student">Student</option>
      </select>

      <button type="submit" class="primary-btn">Assign Badge</button>
    </form>
  </div>

  <!-- Academic Data Management -->
  <div class="section-card">
    <h3>Academic Data</h3>
    <form id="academicForm">
      <label for="acadType">Type:</label>
      <select id="acadType">
        <option value="note">Note</option>
        <option value="assignment">Assignment</option>
        <option value="test">Test</option>
        <option value="notice">Notice</option>
      </select>

      <label for="acadTitle">Title / Subject:</label>
      <input type="text" id="acadTitle" placeholder="Enter title or subject" required>

      <label for="acadContent">Content / Description:</label>
      <textarea id="acadContent" rows="3" placeholder="Enter content here" required></textarea>

      <label for="acadStudent">Assign to Student (optional):</label>
      <select id="acadStudent">
        <!-- Dynamically populated -->
      </select>

      <button type="submit" class="primary-btn">Add / Update</button>
    </form>

    <div class="academic-list" id="academicList">
      <!-- Academic data entries populate here -->
    </div>
  </div>
  <!-- Attendance Management -->
  <div class="section-card">
    <h3>Attendance</h3>
    <div class="attendance-list" id="attendanceList">
      <!-- Attendance records populate here -->
    </div>
    <form id="editAttendanceForm" style="margin-top:15px;">
      <label for="attendanceSubject">Edit Subject Name:</label>
      <input type="text" id="attendanceSubject" placeholder="Enter new subject name">
      <button type="button" class="primary-btn" onclick="updateAttendanceLabel()">Update Attendance Chart</button>
    </form>
  </div>

  <!-- Feedback & Logs -->
  <div class="section-card">
    <h3>Feedback & Logs</h3>
    <div class="feedback-list" id="feedbackList">
      <!-- Feedback entries populate here -->
    </div>
    <div class="admin-logs" id="adminLogs">
      <!-- Logs populate dynamically -->
    </div>
  </div>

  <!-- Analytics Dashboard -->
  <div class="section-card">
    <h3>Analytics</h3>
    <form id="editTestForm">
      <label for="testName">Edit Test Names (comma separated):</label>
      <input type="text" id="testName" placeholder="Test1,Test2,Test3">
      <button type="button" class="primary-btn" onclick="updateTestChart()">Update Test Chart</button>
    </form>
    <canvas id="attendanceChart" width="400" height="200"></canvas>
    <canvas id="testChart" width="400" height="200"></canvas>
    <canvas id="completionChart" width="400" height="200"></canvas>
  </div>

  <!-- Deletion Section -->
  <div class="section-card">
    <h3>Delete Options</h3>
    <form id="deleteForm">
      <label for="deleteUser">Delete User:</label>
      <select id="deleteUser"></select>
      <button type="button" class="primary-btn" onclick="deleteUser()">Delete User</button>

      <label for="deleteBadge">Delete Badge:</label>
      <select id="deleteBadgeUser"></select>
      <select id="deleteBadgeRole">
        <option value="admin">Admin</option>
        <option value="moderator">Moderator</option>
        <option value="tester">Tester</option>
        <option value="faculty">Faculty</option>
        <option value="student">Student</option>
      </select>
      <button type="button" class="primary-btn" onclick="deleteBadge()">Delete Badge</button>

      <label for="deleteBatch">Delete Batch:</label>
      <select id="deleteBatch">
        <!-- Batch 1 to 20 -->
        <script>
          for(let i=1;i<=20;i++){
            document.write(`<option value="${i}">Batch ${i}</option>`);
          }
        </script>
      </select>
      <button type="button" class="primary-btn" onclick="deleteBatch()">Delete Batch</button>
    </form>
  </div>

</div> <!-- end container -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Sample Data
  let users = [
    { role: 'student', username: 'DME123', badges: ['student'] },
    { role: 'faculty', username: 'johndoe@example.com', badges: ['faculty'] },
    { role: 'moderator', username: 'mod1@example.com', badges: ['moderator'] },
  ];

  // Refresh User List
  const userList = document.getElementById('userList');
  const deleteUserSelect = document.getElementById('deleteUser');
  const badgeUserSelect = document.getElementById('badgeUser');
  const deleteBadgeUserSelect = document.getElementById('deleteBadgeUser');

  function refreshUserLists() {
    userList.innerHTML = '';
    deleteUserSelect.innerHTML = '';
    badgeUserSelect.innerHTML = '';
    deleteBadgeUserSelect.innerHTML = '';
    users.forEach(u => {
      const div = document.createElement('div');
      div.textContent = `${u.username} (${u.role.toUpperCase()}) - Badges: ${u.badges.join(', ')}`;
      userList.appendChild(div);

      const opt1 = document.createElement('option'); opt1.value = u.username; opt1.textContent = u.username; deleteUserSelect.appendChild(opt1);
      const opt2 = document.createElement('option'); opt2.value = u.username; opt2.textContent = u.username; badgeUserSelect.appendChild(opt2);
      const opt3 = document.createElement('option'); opt3.value = u.username; opt3.textContent = u.username; deleteBadgeUserSelect.appendChild(opt3);
    });
  }
  refreshUserLists();

  // Create User
  document.getElementById('createUserForm').addEventListener('submit', e => {
    e.preventDefault();
    const role = document.getElementById('role').value;
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    users.push({ role, username, badges: [role] });
    refreshUserLists();
    alert('User created successfully!');
  });

  // Badge Assignment
  document.getElementById('badgeForm').addEventListener('submit', e => {
    e.preventDefault();
    const selectedUser = document.getElementById('badgeUser').value;
    const badge = document.getElementById('badgeRole').value;
    const user = users.find(u => u.username === selectedUser);
    if (user && !user.badges.includes(badge)) user.badges.push(badge);
    refreshUserLists();
    alert('Badge assigned successfully!');
  });

  // Delete User / Badge / Batch
  function deleteUser() {
    const username = deleteUserSelect.value;
    users = users.filter(u => u.username !== username);
    refreshUserLists();
    alert('User deleted!');
  }

  function deleteBadge() {
    const username = deleteBadgeUserSelect.value;
    const badge = document.getElementById('deleteBadgeRole').value;
    const user = users.find(u => u.username === username);
    if(user) user.badges = user.badges.filter(b => b !== badge);
    refreshUserLists();
    alert('Badge removed!');
  }

  function deleteBatch() {
    const batch = document.getElementById('deleteBatch').value;
    alert('Batch ' + batch + ' deleted!');
    // implement deletion logic based on your data structure
  }

  // Logout
  function logout() { alert("Logging out..."); window.location.href="index.html"; }

  // Edit Admin Info
  function toggleEditAdmin() {
    const sec = document.getElementById('editAdminSection');
    sec.style.display = sec.style.display === 'none' ? 'block' : 'none';
  }
  function saveAdminInfo() {
    const name = document.getElementById('editAdminName').value;
    const email = document.getElementById('editAdminEmail').value;
    if(name) document.getElementById('adminName').textContent = name;
    if(email) document.getElementById('adminEmail').textContent = email;
    alert('Admin info updated!');
  }

  // Charts
  const attendanceChart = new Chart(document.getElementById('attendanceChart'), {
    type: 'pie',
    data: { labels:['Maths','Physics','Mechanics'], datasets:[{data:[95,90,92], backgroundColor:['#4f46e5','#3b82f6','#16a34a']}] }
  });
  const testChart = new Chart(document.getElementById('testChart'), {
    type: 'bar',
    data: { labels:['Test1','Test2','Test3'], datasets:[{label:'Scores', data:[80,90,75], backgroundColor:'#2563eb'}] }
  });
  const completionChart = new Chart(document.getElementById('completionChart'), {
    type:'doughnut',
    data:{labels:['Completed','Pending'], datasets:[{data:[12,3], backgroundColor:['#10b981','#f59e0b']}]}
  });

  function updateTestChart(){
    const names = document.getElementById('testName').value.split(',');
    if(names.length>0) testChart.data.labels = names;
    testChart.update();
    alert('Test chart updated!');
  }

  function updateAttendanceLabel(){
    const label = document.getElementById('attendanceSubject').value;
    if(label) attendanceChart.data.labels[0] = label; // example updating first subject
    attendanceChart.update();
    alert('Attendance chart updated!');
  }

</script>

<!-- Moving Background Animation Script -->
<script>
(() => {
  const canvas = document.getElementById('bg-canvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d', { alpha: true });
  let width = canvas.width = window.innerWidth;
  let height = canvas.height = window.innerHeight;
  const baseCount = Math.round((width * height) / 60000);
  let PARTICLE_COUNT = Math.min(120, Math.max(25, baseCount*40));
  if(width<800) PARTICLE_COUNT = Math.min(PARTICLE_COUNT,45);
  const particles = [];
  function rand(min,max){return Math.random()*(max-min)+min;}
  function initParticles(){
    particles.length=0;
    for(let i=0;i<PARTICLE_COUNT;i++){
      const size = rand(1,3.2);
      particles.push({x:rand(0,width), y:rand(0,height), vx:rand(-0.12,0.12), vy:rand(-0.02,0.6), size, alpha:rand(0.06,0.22), hue:rand(200,240)});
    }
  }
  function resize(){width=canvas.width=window.innerWidth;height=canvas.height=window.innerHeight;initParticles();}
  window.addEventListener('resize',()=>{clearTimeout(window._bgResizeTimer);window._bgResizeTimer=setTimeout(resize,120);});
  function draw(){
    ctx.clearRect(0,0,width,height);
    for(let i=0;i<particles.length;i++){
      const p=particles[i];
      p.x+=p.vx;p.y-=p.vy*0.3;
      if(p.x<-50)p.x=width+50;
      if(p.x>width+50)p.x=-50;
      if(p.y<-50)p.y=height+50;
      if(p.y>height+50)p.y=-50;
      ctx.beginPath();
      ctx.fillStyle=`hsla(${p.hue},80%,60%,${p.alpha})`;
      ctx.arc(p.x,p.y,p.size,0,Math.PI*2);ctx.fill();
      for(let j=i+1;j<particles.length&&j<i+6;j++){
        const p2=particles[j];
        const dx=p.x-p2.x;const dy=p.y-p2.y;const dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<120){ctx.beginPath();ctx.strokeStyle=`hsla(${(p.hue+p2.hue)/2},70%,60%,${Math.max(0,0.08-dist/1500)})`;ctx.lineWidth=0.6;ctx.moveTo(p.x,p.y);ctx.lineTo(p2.x,p2.y);ctx.stroke();}
      }
    }
    window.requestAnimationFrame(draw);
  }
  initParticles();draw();
})();
</script>
</body>
</html>
