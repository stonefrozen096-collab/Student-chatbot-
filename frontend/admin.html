<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/animation.css">
  <style>
    body { background: #f4f6f9; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; }
    #bg-canvas { position: fixed; inset:0; width:100vw; height:100vh; z-index:0; pointer-events:none; background:linear-gradient(120deg,#0f172a 0%,#0b1320 50%,#061026 100%); opacity:0.4; }
    .container { position:relative; z-index:2; max-width:1200px; margin:50px auto; padding:20px; }
    .profile-card { background:#fff; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.1); padding:20px; display:flex; gap:20px; align-items:center; margin-bottom:25px; }
    .profile-avatar { width:80px; height:80px; border-radius:50%; background:#4f46e5; display:flex; align-items:center; justify-content:center; color:#fff; font-size:28px; font-weight:bold; flex-shrink:0; }
    .profile-info h2 { margin:0; font-size:22px; color:#0f172a; }
    .profile-info p { margin:4px 0; color:#475569; font-size:14px; }
    .badge-container { margin-top:10px; }
    .badge { display:inline-block; padding:5px 12px; border-radius:12px; margin:3px; font-size:12px; font-weight:600; animation:pop 0.3s ease forwards; cursor:default; }
    .badge.admin { background-color:#e74c3c;color:#fff; }
    .badge.moderator { background-color:#8b5cf6;color:#fff; }
    .badge.tester { background-color:#f59e0b;color:#fff; }
    .badge.faculty { background-color:#3b82f6;color:#fff; }
    .badge.student { background-color:#2ecc71;color:#fff; }
    @keyframes pop {0%{transform:scale(0.8);opacity:0;}100%{transform:scale(1);opacity:1;}}
    .section-card { background:#fff;border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); padding:20px; margin-bottom:20px; }
    .section-card h3 { margin-top:0;color:#2563eb; }
    .logout-btn { padding:8px 15px; border:none; background:#ef4444; color:#fff; border-radius:8px; cursor:pointer; float:right; font-weight:bold; }
    input, select, textarea { width:100%; margin-bottom:12px; padding:10px; border-radius:8px; border:1px solid #d1d5db; outline:none; }
    button.primary-btn { padding:10px 15px; border:none; border-radius:8px; background:linear-gradient(90deg,#4f46e5,#3b82f6); color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
    button.primary-btn:hover { transform:scale(1.03); }
    .user-list, .attendance-list, .feedback-list, .academic-list { max-height:300px; overflow-y:auto; margin-top:10px; }
  </style>
</head>
<body>
<canvas id="bg-canvas" aria-hidden="true"></canvas>

<div class="container">
  <!-- Admin Profile -->
  <div class="profile-card">
    <div class="profile-avatar" id="adminAvatar">A</div>
    <div class="profile-info">
      <h2 id="adminName">Admin Name</h2>
      <p><strong>Email:</strong> <span id="adminEmail">admin@example.com</span></p>
      <div class="badge-container" id="adminBadges"><span class="badge admin">ADMIN</span></div>
      <button class="primary-btn" onclick="editProfile()">Edit Profile</button>
    </div>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <!-- User Management -->
  <div class="section-card">
    <h3>User Management</h3>
    <form id="createUserForm">
      <label for="role">Role:</label>
      <select id="role" required>
        <option value="admin">Admin</option>
        <option value="moderator">Moderator</option>
        <option value="tester">Tester</option>
        <option value="faculty">Faculty</option>
        <option value="student">Student</option>
      </select>

      <label for="username">Username / Email / Reg No:</label>
      <input type="text" id="username" placeholder="Enter username or reg no" required>

      <label for="password">Password (if applicable):</label>
      <input type="password" id="password" placeholder="Password">

      <button type="submit" class="primary-btn">Create User</button>
    </form>

    <div class="user-list" id="userList"></div>

    <!-- Delete Options -->
    <h4>Delete Options</h4>
    <label for="deleteUser">Select User:</label>
    <select id="deleteUser"></select>
    <button class="primary-btn" onclick="deleteUser()">Delete User</button>

    <label for="deleteBadgeUser">Select User for Badge:</label>
    <select id="deleteBadgeUser"></select>
    <button class="primary-btn" onclick="deleteBadge()">Delete Badge</button>

    <label for="deleteBatch">Select Batch:</label>
    <select id="deleteBatch"></select>
    <button class="primary-btn" onclick="deleteBatch()">Delete Batch</button>
  </div>
  <!-- Badges Management -->
  <div class="section-card">
    <h3>Badge Management</h3>
    <form id="badgeForm">
      <label for="badgeUser">Select User:</label>
      <select id="badgeUser"></select>

      <label for="badgeRole">Assign Badge:</label>
      <select id="badgeRole">
        <option value="admin">Admin</option>
        <option value="moderator">Moderator</option>
        <option value="tester">Tester</option>
        <option value="faculty">Faculty</option>
        <option value="student">Student</option>
      </select>

      <button type="submit" class="primary-btn">Assign Badge</button>
    </form>
  </div>

  <!-- Academic Data Management -->
  <div class="section-card">
    <h3>Academic Data</h3>
    <form id="academicForm">
      <label for="acadType">Type:</label>
      <select id="acadType">
        <option value="note">Note</option>
        <option value="assignment">Assignment</option>
        <option value="test">Test</option>
        <option value="notice">Notice</option>
      </select>

      <label for="acadTitle">Title / Subject:</label>
      <input type="text" id="acadTitle" placeholder="Enter title or subject" required>

      <label for="acadContent">Content / Description:</label>
      <textarea id="acadContent" rows="3" placeholder="Enter content here" required></textarea>

      <label for="acadStudent">Assign to Student (optional):</label>
      <select id="acadStudent"></select>

      <button type="submit" class="primary-btn">Add / Update</button>
    </form>
    <div class="academic-list" id="academicList"></div>
  </div>

  <!-- Attendance Management -->
  <div class="section-card">
    <h3>Attendance Management</h3>
    <form id="attendanceForm">
      <label for="attendanceSubject">Subject Name:</label>
      <input type="text" id="attendanceSubject" placeholder="Enter subject name">

      <label for="attendancePercent">Attendance %:</label>
      <input type="number" id="attendancePercent" placeholder="Enter percentage" min="0" max="100">

      <button type="submit" class="primary-btn">Update Attendance</button>
    </form>
    <div class="attendance-list" id="attendanceList"></div>
  </div>

  <!-- Feedback & Logs -->
  <div class="section-card">
    <h3>Feedback & Logs</h3>
    <div class="feedback-list" id="feedbackList"></div>
    <div class="admin-logs
     id="adminLogs"></div>
  </div>

  <!-- Analytics & Test Scores -->
  <div class="section-card">
    <h3>Analytics & Test Scores</h3>

    <!-- Update / Delete Subject Attendance -->
    <label for="chartSubject">Subject Name:</label>
    <input type="text" id="chartSubject" placeholder="Enter subject name">

    <label for="chartValue">Enter % / Value:</label>
    <input type="number" id="chartValue" placeholder="Enter value" min="0" max="100">

    <button class="primary-btn" onclick="updateChart()">Add / Update Subject</button>
    <button class="primary-btn" onclick="deleteChartSubject()">Delete Subject</button>

    <!-- Update / Delete Test Score -->
    <label for="testSubject">Test Subject Name:</label>
    <input type="text" id="testSubject" placeholder="Enter test subject">

    <label for="testScore">Enter Test Score:</label>
    <input type="number" id="testScore" placeholder="Enter score" min="0">

    <button class="primary-btn" onclick="updateTest()">Add / Update Test</button>
    <button class="primary-btn" onclick="deleteTest()">Delete Test</button>

    <canvas id="attendanceChart" width="400" height="200"></canvas>
    <canvas id="testChart" width="400" height="200"></canvas>
    <canvas id="completionChart" width="400" height="200"></canvas>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // ===== Sample Data =====
  const users = [];
  const batches = Array.from({length:20},(_,i)=>i+1);
  const academicData = [];
  const attendanceData = [];
  const testData = [];
  const feedbackData = [];
  const adminLogs = [];

  // ===== User Lists =====
  const userList = document.getElementById('userList');
  const deleteUserSelect = document.getElementById('deleteUser');
  const badgeUserSelect = document.getElementById('badgeUser');
  const deleteBadgeSelect = document.getElementById('deleteBadgeUser');
  const deleteBatchSelect = document.getElementById('deleteBatch');

  function refreshUserLists() {
    userList.innerHTML = '';
    deleteUserSelect.innerHTML = '';
    badgeUserSelect.innerHTML = '';
    deleteBadgeSelect.innerHTML = '';
    users.forEach(u=>{
      const div = document.createElement('div');
      div.textContent = `${u.username} (${u.role.toUpperCase()}) - Badges: ${u.badges.join(', ')}`;
      userList.appendChild(div);
      [deleteUserSelect,badgeUserSelect,deleteBadgeSelect].forEach(sel=>{
        const opt = document.createElement('option');
        opt.value = u.username; opt.textContent = u.username;
        sel.appendChild(opt);
      });
    });
    deleteBatchSelect.innerHTML='';
    batches.forEach(b=>{
      const opt = document.createElement('option');
      opt.value = b; opt.textContent = `Batch ${b}`;
      deleteBatchSelect.appendChild(opt);
    });
  }

  // ===== User CRUD =====
  document.getElementById('createUserForm').addEventListener('submit', e=>{
    e.preventDefault();
    const role = document.getElementById('role').value;
    const username = document.getElementById('username').value;
    users.push({role, username, badges:[role]});
    refreshUserLists(); alert('User created!'); adminLogs.push(`Created ${role}: ${username}`);
  });

  function deleteUser() {
    const sel = deleteUserSelect.value;
    const idx = users.findIndex(u=>u.username===sel);
    if(idx!==-1){ users.splice(idx,1); refreshUserLists(); adminLogs.push(`Deleted user: ${sel}`);}
  }
  function deleteBadge() {
    const sel = deleteBadgeSelect.value;
    const badge = document.getElementById('badgeRole').value;
    const user = users.find(u=>u.username===sel);
    if(user && user.badges.includes(badge)){
      user.badges = user.badges.filter(b=>b!==badge);
      refreshUserLists(); adminLogs.push(`Deleted badge ${badge} from ${sel}`);
    }
  }
  function deleteBatch(){
    const sel = parseInt(deleteBatchSelect.value);
    const idx = batches.indexOf(sel);
    if(idx!==-1){ batches.splice(idx,1); refreshUserLists(); adminLogs.push(`Deleted batch ${sel}`); }
  }

  // ===== Academic =====
  document.getElementById('academicForm').addEventListener('submit', e=>{
    e.preventDefault();
    const type = document.getElementById('acadType').value;
    const title = document.getElementById('acadTitle').value;
    const content = document.getElementById('acadContent').value;
    const student = document.getElementById('acadStudent').value || 'All';
    academicData.push({type,title,content,student});
    renderAcademic(); adminLogs.push(`Added ${type}: ${title} -> ${student}`);
  });
  function renderAcademic(){
    const container=document.getElementById('academicList'); container.innerHTML='';
    academicData.forEach(a=>{
      const div=document.createElement('div'); div.textContent=`[${a.type.toUpperCase()}] ${a.title} -> ${a.student}`;
      container.appendChild(div);
    });
  }

  // ===== Attendance =====
  document.getElementById('attendanceForm').addEventListener('submit', e=>{
    e.preventDefault();
    const subj = document.getElementById('attendanceSubject').value;
    const percent = parseFloat(document.getElementById('attendancePercent').value);
    const idx = attendanceData.findIndex(a=>a.subject===subj);
    if(idx!==-1) attendanceData[idx].percent = percent;
    else attendanceData.push({subject:subj,percent});
    renderAttendance(); updateChart(); adminLogs.push(`Updated attendance ${subj}: ${percent}%`);
  });
  function renderAttendance(){
    const container=document.getElementById('attendanceList'); container.innerHTML='';
    attendanceData.forEach(a=>{ const div=document.createElement('div'); div.textContent=`${a.subject}: ${a.percent}%`; container.appendChild(div); });
  }

  // ===== Charts =====
  let attendanceChart = new Chart(document.getElementById('attendanceChart'), {type:'pie', data:{labels:[],datasets:[{data:[],backgroundColor:[]}]}} );
  let testChart = new Chart(document.getElementById('testChart'), {type:'bar', data:{labels:[],datasets:[{label:'Scores',data:[],backgroundColor:'#2563eb'}]}} );
  let completionChart = new Chart(document.getElementById('completionChart'), {type:'doughnut', data:{labels:['Completed','Pending'],datasets:[{data:[0,0],backgroundColor:['#10b981','#f59e0b']}]}} );

  function updateChart(){
    const subj=document.getElementById('chartSubject').value;
    const val=parseFloat(document.getElementById('chartValue').value);
    const idx=attendanceData.findIndex(a=>a.subject===subj);
    if(idx!==-1) attendanceData[idx].percent=val;
    else attendanceData.push({subject:subj,percent:val});
    renderAttendance();
    attendanceChart.data.labels = attendanceData.map(a=>a.subject);
    attendanceChart.data.datasets[0].data = attendanceData.map(a=>a.percent);
    attendanceChart.data.datasets[0].backgroundColor = attendanceData.map((_,i)=>`hsl(${i*50%360},70%,50%)`);
    attendanceChart.update();
  }
  function deleteChartSubject(){
    const subj=document.getElementById('chartSubject').value;
    const idx=attendanceData.findIndex(a=>a.subject===subj);
    if(idx!==-1){ attendanceData.splice(idx,1); updateChart(); adminLogs.push(`Deleted attendance subject: ${subj}`); }
  }

  // ===== Test Scores =====
  function updateTest(){
    const subj=document.getElementById('testSubject').value;
    const score=parseFloat(document.getElementById('testScore').value);
    const idx=testData.findIndex(t=>t.subject===subj);
    if(idx!==-1) testData[idx].score = score;
    else testData.push({subject:subj,score});
    testChart.data.labels = testData.map(t=>t.subject);
    testChart.data.datasets[0].data = testData.map(t=>t.score);
    testChart.update(); adminLogs.push(`Updated test ${subj}: ${score}`);
  }
  function deleteTest(){
    const subj=document.getElementById('testSubject').value;
    const idx=testData.findIndex(t=>t.subject===subj);
    if(idx!==-1){ testData.splice(idx,1); updateTest(); adminLogs.push(`Deleted test: ${subj}`); }
  }

  // ===== Feedback & Logs =====
  function renderFeedbackLogs(){
    const fbContainer=document.getElementById('feedbackList'); fbContainer.innerHTML='';
    feedbackData.forEach(f=>{ const div=document.createElement('div'); div.textContent=f; fbContainer.appendChild(div); });
    const logContainer=document.getElementById('adminLogs'); logContainer.innerHTML='';
    adminLogs.forEach(l=>{ const div=document.createElement('div'); div.textContent=l; logContainer.appendChild(div); });
  }

  // ===== Logout / Edit Profile =====
  function logout(){ alert("Logging out..."); window.location.href="index.html"; }
  function editProfile(){
    const newName=prompt("Enter new Admin name:", document.getElementById('adminName').textContent);
    if(newName){ document.getElementById('adminName').textContent=newName; adminLogs.push(`Admin changed name to ${newName}`); renderFeedbackLogs();}
    const newEmail=prompt("Enter new Admin email:", document.getElementById('adminEmail').textContent);
    if(newEmail){ document.getElementById('adminEmail').textContent=newEmail; adminLogs.push(`Admin changed email to ${newEmail}`); renderFeedbackLogs();}
  }

  // ===== Initialize =====
  refreshUserLists(); renderFeedbackLogs();
</script>

</body>
</html>
