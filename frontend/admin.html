<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard</title>
<style>
  body { margin:0; font-family: 'Segoe UI', sans-serif; background:#f5f5f5; }
  .container { max-width:1200px; margin:20px auto; padding:10px; }
  .row { display:flex; flex-wrap:wrap; gap:20px; }
  .col { flex:1; min-width:300px; background:white; padding:15px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.05); }
  h3 { margin-top:0; color:#1f2937; }
  input, textarea, select { width:100%; padding:8px; margin:4px 0 10px; border-radius:5px; border:1px solid #ccc; }
  button { padding:6px 12px; border:none; border-radius:5px; cursor:pointer; }
  button.btn-primary { background:#4f46e5; color:white; }
  button.btn-ghost { background:#e5e7eb; color:#374151; }
  button.btn-danger { background:#ef4444; color:white; }
  .list { max-height:300px; overflow-y:auto; }
  .small { font-size:0.85rem; color:#6b7280; }
  .space { height:10px; }
  .card-header { font-weight:bold; margin-bottom:8px; color:#111827; }
  .summary-cards { display:flex; gap:12px; flex-wrap:wrap; }
  .summary-card { flex:1; padding:12px; text-align:center; color:white; border-radius:8px; }
  .summary-card.attendance { background:#3b82f6; }
  .summary-card.marks { background:#10b981; }
  .summary-card.top { background:#f59e0b; }
  canvas { background:#f3f4f6; border-radius:8px; }
</style>
</head>
<body>
<canvas id="bg-canvas" style="position:fixed;top:0;left:0;z-index:-1;"></canvas>

<div class="container">
  <!-- Summary Cards -->
  <div class="row">
    <div class="col">
      <h3>Analytics Summary</h3>
      <div class="summary-cards">
        <div class="summary-card attendance">
          <div>Average Attendance</div>
          <div id="avgAttendance" style="font-size:20px;font-weight:bold;">0%</div>
        </div>
        <div class="summary-card marks">
          <div>Average Marks</div>
          <div id="avgMarks" style="font-size:20px;font-weight:bold;">0</div>
        </div>
        <div class="summary-card top">
          <div>Top Student</div>
          <div id="topStudent" style="font-size:20px;font-weight:bold;">-</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row">
    <div class="col">
      <h3>Attendance Chart</h3>
      <canvas id="attendanceChart" height="200"></canvas>
    </div>
    <div class="col">
      <h3>Test Marks Chart</h3>
      <canvas id="testChart" height="200"></canvas>
    </div>
  </div>

  <!-- Placeholder Sections -->
  <div class="row">
    <div class="col" id="attendanceSection">
      <h3>Attendance Section</h3>
      <!-- Attendance table will go here -->
    </div>
    <div class="col" id="testCreationSection">
      <h3>Test Creation Section</h3>
      <!-- MCQ / Short answer form will go here -->
    </div>
  </div>

  <div class="row">
    <div class="col" id="triggersSection">
      <h3>Chatbot Trigger Words / Phrases</h3>
      <!-- Trigger form will go here -->
    </div>
    <div class="col" id="masterCommandsSection">
      <h3>Master Commands</h3>
      <!-- Master command form will go here -->
    </div>
  </div>

  <div class="row">
    <div class="col" id="importExportSection">
      <h3>Import / Export Data</h3>
      <!-- Import/export buttons -->
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Placeholder for future JS (charts, triggers, attendance, tests)
</script>
</body>
</html>
<div class="card" id="attendanceSection">
  <h3>Student Attendance</h3>
  
  <!-- Student Attendance Table -->
  <table class="attendance-table">
    <thead>
      <tr>
        <th>Student</th>
        <th>Present</th>
        <th>Absent</th>
        <th>Late</th>
        <th>On Duty</th>
      </tr>
    </thead>
    <tbody id="attendanceTableBody">
      <!-- JS will populate student rows here -->
    </tbody>
  </table>

  <div style="margin-top:10px; display:flex; gap:8px;">
    <button class="btn btn-primary" onclick="saveAttendance()">Save Attendance</button>
    <button class="btn btn-secondary" onclick="exportAttendance()">Export Attendance</button>
    <button class="btn btn-ghost" onclick="importAttendancePrompt()">Import Attendance</button>
  </div>
</div>
<div class="card" id="testCreationSection">
  <h3>Create Test</h3>

  <form id="testForm">
    <label>Test Type</label>
    <select id="testTypeSelect">
      <option value="mcq">MCQ</option>
      <option value="short">Short Answer</option>
    </select>

    <label>Subject</label>
    <input type="text" id="testSubjectInput" placeholder="e.g. Math" required>

    <label>Question</label>
    <textarea id="testQuestionInput" placeholder="Enter the question..." required></textarea>

    <!-- MCQ Options Section -->
    <div id="mcqOptionsContainer" style="display:none;">
      <label>Options</label>
      <div id="mcqOptionsList"></div>
      <button type="button" class="btn btn-ghost" onclick="addMCQOption()">Add Option</button>
      <label>Correct Answer</label>
      <select id="mcqAnswerSelect"></select>
    </div>

    <label>Assign to student (optional)</label>
    <select id="testAssignStudent">
      <option value="">All Students</option>
    </select>

    <div style="margin-top:10px; display:flex; gap:8px;">
      <button type="submit" class="btn btn-primary">Add Test</button>
      <button type="button" class="btn btn-ghost" onclick="renderCreatedTests()">Refresh</button>
    </div>
  </form>

  <div class="space"></div>
  <div class="muted small">Test List</div>
  <div id="createdTestList" class="list"></div>

  <div style="margin-top:10px; display:flex; gap:8px;">
    <button class="btn btn-secondary" onclick="exportTests()">Export Tests</button>
    <button class="btn btn-ghost" onclick="importTestsPrompt()">Import Tests</button>
  </div>
</div>
/* ---------- Export / Import All Data ---------- */
function exportAllData(){
  const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'student_assistant_all_data.json';
  a.click();
  URL.revokeObjectURL(url);
  addLog('Exported all data');
}

function importAllDataPrompt(){
  const input = document.createElement('input'); 
  input.type='file'; input.accept='application/json';
  input.onchange = e => {
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = evt => {
      try {
        const data = JSON.parse(evt.target.result);
        if(confirm('Replace all current data with imported data?')){
          state = Object.assign({}, defaultState, data);
          addLog('Imported all data');
          saveStorage();
          updateAll();
        }
      } catch(err){ alert('Invalid JSON'); }
    };
    reader.readAsText(file);
  };
  input.click();
}

/* ---------- Export / Import Attendance Only ---------- */
function exportAttendance(){
  const blob = new Blob([JSON.stringify(state.attendance || [], null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'attendance_data.json';
  a.click();
  URL.revokeObjectURL(url);
  addLog('Exported attendance');
}

function importAttendancePrompt(){
  const input = document.createElement('input'); 
  input.type='file'; input.accept='application/json';
  input.onchange = e => {
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = evt => {
      try {
        const data = JSON.parse(evt.target.result);
        if(Array.isArray(data)){
          state.attendance = data;
          addLog('Imported attendance');
          saveStorage();
          updateAll();
        } else alert('Invalid attendance data');
      } catch(err){ alert('Invalid JSON'); }
    };
    reader.readAsText(file);
  };
  input.click();
}
<!-- ROW 13: Test / MCQ Creation -->
<div class="container">
  <div class="row">
    <div class="col card">
      <h3>Create Test</h3>
      <form id="createTestForm">
        <label>Test Type</label>
        <select id="testTypeSelect">
          <option value="mcq">MCQ</option>
          <option value="short">Short Answer</option>
        </select>

        <label>Subject</label>
        <input type="text" id="testSubjectInput" placeholder="Subject e.g. Math" required>

        <label>Question</label>
        <textarea id="testQuestionInput" placeholder="Enter the question..." required></textarea>

        <!-- MCQ Options Section -->
        <div id="mcqOptionsContainer" style="display:none;">
          <label>Options (comma separated)</label>
          <input type="text" id="mcqOptionsInput" placeholder="Option1,Option2,Option3,...">
          <label>Correct Option</label>
          <input type="text" id="mcqAnswerInput" placeholder="Enter correct option text">
        </div>

        <label>Assign to student (optional)</label>
        <select id="testAssignStudent"><option value="">All Students</option></select>

        <div style="margin-top:10px; display:flex; gap:8px;">
          <button type="submit" class="btn btn-primary">Add Test</button>
          <button type="button" class="btn btn-ghost" onclick="renderCreatedTests()">Refresh</button>
        </div>
      </form>

      <div class="space"></div>
      <div class="muted small">Test List</div>
      <div id="createdTestList" class="list"></div>
    </div>
  </div>
</div>

<script>
/* ---------- Test Creation ---------- */
const testTypeSelect = document.getElementById('testTypeSelect');
const mcqContainer = document.getElementById('mcqOptionsContainer');
testTypeSelect.addEventListener('change', ()=>{
  mcqContainer.style.display = testTypeSelect.value==='mcq'?'block':'none';
});

document.getElementById('createTestForm').addEventListener('submit', e=>{
  e.preventDefault();
  const type = testTypeSelect.value;
  const subject = document.getElementById('testSubjectInput').value.trim();
  const question = document.getElementById('testQuestionInput').value.trim();
  const student = document.getElementById('testAssignStudent').value||'';
  if(!subject||!question) return alert('Enter subject & question');

  let testItem = {id:'test_'+Date.now(), type, subject, question, student};

  if(type==='mcq'){
    const options = document.getElementById('mcqOptionsInput').value.split(',').map(o=>o.trim()).filter(Boolean);
    const answer = document.getElementById('mcqAnswerInput').value.trim();
    if(options.length<2 || !answer || !options.includes(answer)) return alert('Invalid MCQ options or answer');
    testItem.options = options; testItem.answer = answer;
  }

  state.createdTests = state.createdTests||[];
  state.createdTests.unshift(testItem);
  addLog(`Created ${type} test for ${subject}`);
  saveStorage(); renderCreatedTests();
  document.getElementById('createTestForm').reset();
});

function renderCreatedTests(){
  const c = document.getElementById('createdTestList'); c.innerHTML='';
  (state.createdTests||[]).forEach(t=>{
    const div=document.createElement('div');
    div.style.padding='8px'; div.style.borderBottom='1px solid rgba(255,255,255,0.02)';
    div.innerHTML=`
      <strong>[${t.type.toUpperCase()}]</strong> ${t.subject}
      <div class="small">For: ${t.student||'All'}</div>
      <div>${t.question}</div>
      ${t.type==='mcq'?'<div>Options: '+t.options.join(', ')+' | Answer: '+t.answer+'</div>':''}
      <div style="margin-top:6px">
        <button class="btn tiny btn-ghost" onclick="editCreatedTest('${t.id}')">Edit</button>
        <button class="btn tiny btn-danger" onclick="deleteCreatedTest('${t.id}')">Delete</button>
      </div>`;
    c.appendChild(div);
  });

  // Update student select
  const sel = document.getElementById('testAssignStudent');
  sel.innerHTML='<option value="">All Students</option>';
  (state.users||[]).filter(u=>u.role==='student').forEach(s=>{
    sel.insertAdjacentHTML('beforeend',`<option value="${s.username}">${s.username}</option>`);
  });
}

function editCreatedTest(id){
  const t = state.createdTests.find(x=>x.id===id); if(!t) return;
  const newQ = prompt('Question', t.question); if(newQ!==null) t.question=newQ;
  if(t.type==='mcq'){
    const newOpts = prompt('Options (comma separated)', t.options.join(',')); if(newOpts!==null) t.options=newOpts.split(',').map(o=>o.trim());
    const newAns = prompt('Answer', t.answer); if(newAns!==null) t.answer=newAns;
  }
  addLog(`Edited test ${t.subject}`);
  saveStorage(); renderCreatedTests();
}

function deleteCreatedTest(id){
  if(!confirm('Delete this test?')) return;
  state.createdTests = state.createdTests.filter(x=>x.id!==id);
  addLog(`Deleted test ${id}`);
  saveStorage(); renderCreatedTests();
}
    </script>
    <!-- ROW 14: Import / Export Section -->
<div class="container">
  <div class="row">
    <div class="col card">
      <h3>Import / Export Data</h3>
      
      <!-- Attendance -->
      <div class="section">
        <h4>Attendance</h4>
        <button class="btn btn-primary" onclick="exportAttendance()">Export Attendance</button>
        <button class="btn btn-secondary" onclick="importAttendance()">Import Attendance</button>
      </div>

      <!-- Tests -->
      <div class="section">
        <h4>Tests</h4>
        <button class="btn btn-primary" onclick="exportTests()">Export Tests</button>
        <button class="btn btn-secondary" onclick="importTests()">Import Tests</button>
      </div>

      <!-- Triggers -->
      <div class="section">
        <h4>Chatbot Triggers</h4>
        <button class="btn btn-primary" onclick="exportTriggers()">Export Triggers</button>
        <button class="btn btn-secondary" onclick="importTriggers()">Import Triggers</button>
      </div>

      <!-- Master Commands -->
      <div class="section">
        <h4>Master Commands</h4>
        <button class="btn btn-primary" onclick="exportMaster()">Export Commands</button>
        <button class="btn btn-secondary" onclick="importMaster()">Import Commands</button>
      </div>

      <!-- Full Backup -->
      <div class="section">
        <h4>Full Backup / Restore</h4>
        <button class="btn btn-primary" onclick="exportAll()">Export Full Data</button>
        <button class="btn btn-danger" onclick="importAll()">Import Full Data</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------- Export Functions ---------- */
function exportAttendance() {
  const blob = new Blob([JSON.stringify(state.attendance || [], null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='attendance.json'; a.click();
  URL.revokeObjectURL(url);
}

function exportTests() {
  const blob = new Blob([JSON.stringify(state.createdTests || [], null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='tests.json'; a.click();
  URL.revokeObjectURL(url);
}

function exportTriggers() {
  const blob = new Blob([JSON.stringify(state.triggers || [], null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='triggers.json'; a.click();
  URL.revokeObjectURL(url);
}

function exportMaster() {
  const blob = new Blob([JSON.stringify(state.masterCommands || [], null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='master_commands.json'; a.click();
  URL.revokeObjectURL(url);
}

function exportAll() {
  const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='full_backup.json'; a.click();
  URL.revokeObjectURL(url);
}

/* ---------- Import Functions ---------- */
function importAttendance() { importJSON('attendance'); }
function importTests() { importJSON('tests'); }
function importTriggers() { importJSON('triggers'); }
function importMaster() { importJSON('masterCommands'); }
function importAll() { importJSON('all'); }

function importJSON(type) {
  const input = document.createElement('input'); input.type='file'; input.accept='application/json';
  input.onchange = e=>{
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = evt=>{
      try {
        const data = JSON.parse(evt.target.result);
        if(confirm('Replace existing data with imported data?')){
          switch(type){
            case 'attendance': state.attendance = data || []; break;
            case 'tests': state.createdTests = data || []; break;
            case 'triggers': state.triggers = data || []; break;
            case 'masterCommands': state.masterCommands = data || []; break;
            case 'all': state = Object.assign({}, defaultState, data); break;
          }
          addLog(`Imported ${type} data via file`);
          persistAndRender();
        }
      } catch(err){ alert('Invalid JSON file'); }
    };
    reader.readAsText(file);
  };
  input.click();
}
</script>
<!-- ROW: Attendance & Marks -->
<div class="container">
  <div class="row">
    <div class="col card">
      <h3>Manage Attendance & Marks</h3>
      <form id="attendanceForm">
        <label>Select Student</label>
        <select id="attendanceStudentSelect">
          <option value="">--Select Student--</option>
        </select>

        <label>Subject</label>
        <input type="text" id="attendanceSubjectInput" placeholder="e.g. Math" required>

        <label>Status</label>
        <select id="attendanceStatus">
          <option value="Present">Present</option>
          <option value="Absent">Absent</option>
          <option value="Late">Late</option>
          <option value="On Duty">On Duty</option>
        </select>

        <label>Marks (Optional)</label>
        <input type="number" id="attendanceMarksInput" placeholder="0-100" min="0" max="100">

        <div style="margin-top:10px; display:flex; gap:8px;">
          <button type="submit" class="btn btn-primary">Add Attendance</button>
          <button type="button" class="btn btn-ghost" onclick="renderAttendanceList()">Refresh</button>
        </div>
      </form>

      <div class="space"></div>
      <div class="muted small">Attendance Records</div>
      <div id="attendanceList" class="list"></div>
    </div>

    <div class="col card">
      <h3>Attendance & Marks Chart</h3>
      <canvas id="attendanceChart"></canvas>
    </div>
  </div>
</div>

<script>
/* ---------- Populate Student Select ---------- */
function populateAttendanceStudents(){
  const sel = document.getElementById('attendanceStudentSelect');
  sel.innerHTML = '<option value="">--Select Student--</option>';
  (state.users||[]).filter(u=>u.role==='student').forEach(s=>{
    sel.insertAdjacentHTML('beforeend', `<option value="${s.username}">${s.username}</option>`);
  });
}

/* ---------- Add Attendance ---------- */
document.getElementById('attendanceForm').addEventListener('submit', e=>{
  e.preventDefault();
  const student = document.getElementById('attendanceStudentSelect').value;
  const subject = document.getElementById('attendanceSubjectInput').value.trim();
  const status = document.getElementById('attendanceStatus').value;
  const marks = parseFloat(document.getElementById('attendanceMarksInput').value) || 0;

  if(!student || !subject || !status) return alert('Fill all required fields');

  state.attendance = state.attendance||[];
  const id = 'att_'+Date.now();
  state.attendance.unshift({id, student, subject, status, marks});
  addLog(`Added attendance for ${student} (${subject})`);
  saveStorage();
  renderAttendanceList();
  renderAttendanceChart();
  document.getElementById('attendanceForm').reset();
});

/* ---------- Render Attendance List ---------- */
function renderAttendanceList(){
  const c = document.getElementById('attendanceList');
  if(!state.attendance || !state.attendance.length){
    c.innerHTML = '<div class="small muted">No attendance records yet</div>';
    return;
  }
  c.innerHTML = state.attendance.map((a,i)=>{
    return `<div style="padding:6px;border-bottom:1px solid rgba(255,255,255,0.1)">
      <strong>${a.student}</strong> - ${a.subject} : ${a.status} | Marks: ${a.marks}
      <button class="btn tiny btn-danger" onclick="deleteAttendance('${a.id}')">Delete</button>
    </div>`;
  }).join('');
}

/* ---------- Delete Attendance ---------- */
function deleteAttendance(id){
  if(!confirm('Delete this attendance record?')) return;
  state.attendance = state.attendance.filter(a=>a.id!==id);
  addLog(`Deleted attendance ${id}`);
  saveStorage();
  renderAttendanceList();
  renderAttendanceChart();
}

/* ---------- Attendance Chart ---------- */
let attendanceChartInstance = null;
function renderAttendanceChart(){
  const ctx = document.getElementById('attendanceChart').getContext('2d');

  const students = [...new Set((state.attendance||[]).map(a=>a.student))];
  const presentCounts = students.map(s=>state.attendance.filter(a=>a.student===s && a.status==='Present').length);
  const absentCounts = students.map(s=>state.attendance.filter(a=>a.student===s && a.status==='Absent').length);
  const lateCounts = students.map(s=>state.attendance.filter(a=>a.student===s && a.status==='Late').length);
  const onDutyCounts = students.map(s=>state.attendance.filter(a=>a.student===s && a.status==='On Duty').length);

  const data = {
    labels: students,
    datasets:[
      {label:'Present', data:presentCounts, backgroundColor:'#10b981'},
      {label:'Absent', data:absentCounts, backgroundColor:'#ef4444'},
      {label:'Late', data:lateCounts, backgroundColor:'#f59e0b'},
      {label:'On Duty', data:onDutyCounts, backgroundColor:'#3b82f6'}
    ]
  };

  const options = {responsive:true, plugins:{legend:{position:'top'}}, scales:{y:{beginAtZero:true}}};

  if(attendanceChartInstance){
    attendanceChartInstance.data = data;
    attendanceChartInstance.update();
  } else {
    attendanceChartInstance = new Chart(ctx,{type:'bar', data, options});
  }
}

/* ---------- Initialize ---------- */
populateAttendanceStudents();
renderAttendanceList();
renderAttendanceChart();
       </script>

