<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feathers ‚Äî Student Assistant</title>

  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #0077ff, #00d4ff);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      overflow: hidden;
    }

    /* Floating background feathers */
    @keyframes floatFeather {
      0% { transform: translateY(0) rotate(0deg); opacity: 0.6; }
      50% { opacity: 1; }
      100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
    }

    .feather {
      position: absolute;
      bottom: -10%;
      width: 40px;
      height: 40px;
      background: url('https://cdn-icons-png.flaticon.com/512/616/616408.png') no-repeat center;
      background-size: contain;
      animation: floatFeather 12s linear infinite;
      opacity: 0.7;
    }

    .feather:nth-child(1) { left: 10%; animation-delay: 0s; }
    .feather:nth-child(2) { left: 25%; animation-delay: 3s; transform: scale(0.8); }
    .feather:nth-child(3) { left: 50%; animation-delay: 6s; transform: scale(1.1); }
    .feather:nth-child(4) { left: 70%; animation-delay: 1s; transform: scale(0.9); }
    .feather:nth-child(5) { left: 85%; animation-delay: 4s; transform: scale(1); }

    .container {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 20px;
      backdrop-filter: blur(12px);
      padding: 40px 50px;
      width: 340px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      text-align: center;
      animation: fadeIn 1s ease-in;
      z-index: 5;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-size: 34px;
      font-weight: 700;
      color: #ffffff;
      letter-spacing: 2px;
      text-shadow: 0 3px 15px rgba(255, 255, 255, 0.3);
      margin-bottom: 5px;
      animation: floatTitle 3s ease-in-out infinite;
    }

    @keyframes floatTitle {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    .tagline {
      font-size: 14px;
      color: #e0f7ff;
      letter-spacing: 1px;
      margin-bottom: 20px;
      opacity: 0.9;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    input {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: none;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.9);
      font-size: 15px;
      outline: none;
    }

    button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      background: #0077ff;
      color: white;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #00bfff;
      transform: translateY(-2px);
    }

    a {
      color: #fff;
      text-decoration: underline;
      font-size: 14px;
      cursor: pointer;
    }

    a:hover {
      color: #00ffff;
    }

    .feedback-msg {
      margin-top: 10px;
      font-size: 14px;
      font-weight: 500;
    }

    h2 {
      color: #fff;
      font-size: 20px;
      margin-bottom: 10px;
    }

    section {
      display: none;
      animation: fadeIn 0.6s ease-in;
    }

    #auth-section {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Floating Feathers Animation -->
  <div class="feather"></div>
  <div class="feather"></div>
  <div class="feather"></div>
  <div class="feather"></div>
  <div class="feather"></div>

  <div class="container">
    <h1>ü™∂ Feathers</h1>
    <p class="tagline">Be light like a feather</p>

    <!-- Login / Signup -->
    <section id="auth-section">
      <input type="text" id="authName" placeholder="Full Name (for signup)">
      <input type="email" id="authEmail" placeholder="Email">
      <input type="password" id="authPassword" placeholder="Password">
      <button id="loginBtn">Login</button>
      <button id="signupBtn">Sign Up</button>
      <p><a id="forgotLink">Forgot Password?</a></p>
      <p id="authMsg" class="feedback-msg"></p>
    </section>

    <!-- Forgot Password -->
    <section id="forgot-section">
      <h2>Forgot Password</h2>
      <input type="email" id="fpEmail" placeholder="Registered Email">
      <button id="sendTokenBtn">Send Reset Token</button>
      <p id="fpMsg"></p>
      <p><a id="backToAuth">Back</a></p>
    </section>

    <!-- Reset Password -->
    <section id="reset-section">
      <h2>Reset Password</h2>
      <input type="text" id="resetToken" placeholder="Enter token">
      <input type="password" id="newPassword" placeholder="New Password">
      <input type="password" id="confirmPassword" placeholder="Confirm Password">
      <button id="resetBtn">Reset Password</button>
      <p id="resetMsg"></p>
    </section>
  </div>

  <!-- ‚úÖ Socket.IO Client -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

  <script>
    // ‚úÖ Backend URL (Render)
    const API_URL = "https://feathers-26g1.onrender.com";

    // ‚úÖ Socket Connection Test
    const socket = io(API_URL, {
      transports: ["websocket", "polling"],
      reconnectionAttempts: 5,
      reconnectionDelay: 2000,
    });

    socket.on("connect", () => {
      console.log("‚úÖ Socket connected to backend:", socket.id);
      socket.emit("pingFromClient", { msg: "Hello from frontend üëã" });
    });

    socket.on("pongFromServer", (data) => console.log("üì© Reply from backend:", data));
    socket.on("disconnect", () => console.warn("‚ö†Ô∏è Socket disconnected"));

    const authSection = document.getElementById('auth-section');
    const forgotSection = document.getElementById('forgot-section');
    const resetSection = document.getElementById('reset-section');

    const authMsg = document.getElementById('authMsg');
    const fpMsg = document.getElementById('fpMsg');
    const resetMsg = document.getElementById('resetMsg');

    // Section toggles
    document.getElementById('forgotLink').addEventListener('click', () => {
      authSection.style.display = 'none';
      forgotSection.style.display = 'block';
    });

    document.getElementById('backToAuth').addEventListener('click', () => {
      forgotSection.style.display = 'none';
      resetSection.style.display = 'none';
      authSection.style.display = 'block';
    });

    // ------------------- Login -------------------
    document.getElementById('loginBtn').addEventListener('click', async () => {
      const email = document.getElementById('authEmail').value.trim();
      const password = document.getElementById('authPassword').value.trim();
      authMsg.textContent = '';

      try {
        const res = await fetch(`${API_URL}/api/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (res.ok) {
          authMsg.style.color = 'lightgreen';
          authMsg.textContent = '‚úÖ Login successful! Redirecting...';
          setTimeout(() => window.location.href = 'dashboard.html', 1000);
        } else {
          authMsg.style.color = 'salmon';
          authMsg.textContent = data.error || 'Login failed';
        }
      } catch {
        authMsg.style.color = 'salmon';
        authMsg.textContent = 'Error connecting to server.';
      }
    });

    // ------------------- Signup -------------------
    document.getElementById('signupBtn').addEventListener('click', async () => {
      const name = document.getElementById('authName').value.trim();
      const email = document.getElementById('authEmail').value.trim();
      const password = document.getElementById('authPassword').value.trim();
      authMsg.textContent = '';

      if (!name || !email || !password) {
        authMsg.style.color = 'salmon';
        authMsg.textContent = 'All fields are required for signup.';
        return;
      }

      try {
        const res = await fetch(`${API_URL}/api/users`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, password })
        });
        const data = await res.json();
        if (!data.error) {
          authMsg.style.color = 'lightgreen';
          authMsg.textContent = '‚úÖ Signup successful! You can login now.';
          document.getElementById('authName').value = '';
          document.getElementById('authPassword').value = '';
        } else {
          authMsg.style.color = 'salmon';
          authMsg.textContent = data.error;
        }
      } catch {
        authMsg.style.color = 'salmon';
        authMsg.textContent = 'Error connecting to server.';
      }
    });

    // ------------------- Forgot Password -------------------
    document.getElementById('sendTokenBtn').addEventListener('click', async () => {
      const email = document.getElementById('fpEmail').value.trim();
      fpMsg.textContent = '';
      try {
        const res = await fetch(`${API_URL}/admin/forgot-password`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const data = await res.json();
        fpMsg.style.color = res.ok ? 'lightgreen' : 'salmon';
        fpMsg.textContent = data.msg;
        if (res.ok) resetSection.style.display = 'block';
      } catch {
        fpMsg.style.color = 'salmon';
        fpMsg.textContent = 'Error sending request.';
      }
    });

    // ------------------- Reset Password -------------------
    document.getElementById('resetBtn').addEventListener('click', async () => {
      const token = document.getElementById('resetToken').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();

      resetMsg.textContent = '';

      if (newPassword !== confirmPassword) {
        resetMsg.style.color = 'salmon';
        resetMsg.textContent = 'Passwords do not match.';
        return;
      }

      try {
        const res = await fetch(`${API_URL}/admin/reset-password`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token, newPassword })
        });
        const data = await res.json();
        resetMsg.style.color = res.ok ? 'lightgreen' : 'salmon';
        resetMsg.textContent = data.msg;
        if (res.ok) {
          document.getElementById('resetToken').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('confirmPassword').value = '';
        }
      } catch {
        resetMsg.style.color = 'salmon';
        resetMsg.textContent = 'Error resetting password.';
      }
    })();
  </script>
  <!-- üß© Mini Eruda Console -->
<script>
(function() {
  var script = document.createElement('script');
  script.src = 'https://cdn.jsdelivr.net/npm/eruda';
  script.onload = function() {
    eruda.init();
    eruda.show(); // auto open console

    // ‚¨áÔ∏è Make Eruda smaller and reposition it
    const style = document.createElement('style');
    style.textContent = `
      .eruda-container {
        width: 80% !important;
        height: 40% !important;
        right: 10px !important;
        bottom: 10px !important;
        border-radius: 12px !important;
        overflow: hidden !important;
        z-index: 999999 !important;
      }
      .eruda-entry-btn {
        right: 12px !important;
        bottom: 12px !important;
        opacity: 0.8 !important;
      }
    `;
    document.head.appendChild(style);
    console.log("ü™∂ Mini Eruda console loaded successfully.");
  };
  document.body.appendChild(script);
})();
</script>
</body>
</html>
