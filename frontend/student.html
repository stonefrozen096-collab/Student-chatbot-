<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard</title>
<link rel="stylesheet" href="css/common.css">
<style>
  body { font-family: "Segoe UI", sans-serif; background:#f4f6f9; margin:0; padding:0; }
  .container { max-width:1000px; margin:20px auto; padding:15px; }
  .section-card { background:#fff; border-radius:12px; padding:20px; margin-bottom:20px; box-shadow:0 4px 12px rgba(0,0,0,0.08);}
  h3 { color:#2563eb; margin-top:0; }
  input, textarea { width:100%; margin:5px 0 15px; padding:10px; border-radius:8px; border:1px solid #d1d5db; }
  button.primary-btn { padding:10px 15px; border:none; border-radius:8px; background:#2563eb; color:#fff; cursor:pointer; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { padding:8px; border-bottom:1px solid #e5e7eb; }
  #chatResponses div { margin:3px 0; }
</style>
</head>
<body>
<div class="container">
  <!-- Student Info -->
  <div class="section-card">
    <h3>Student Info</h3>
    <p><strong>Name:</strong> <span id="studentName">Hari Prasath</span></p>
    <p><strong>Reg No:</strong> <span id="studentReg">DME123</span></p>
    <p><strong>Email:</strong> <span id="studentEmail">hari@example.com</span></p>
    <p><strong>Role:</strong> STUDENT/TESTER</p>
    <button class="primary-btn" onclick="logout()">Logout</button>
  </div>

  <!-- Assigned Faculty -->
  <div class="section-card">
    <h3>Assigned Faculty</h3>
    <ul id="assignedFaculty">
      <li>Mr. John Doe</li>
      <li>Ms. Jane Smith</li>
    </ul>
  </div>

  <!-- Attendance Summary -->
  <div class="section-card">
    <h3>Attendance Summary</h3>
    <div id="attendanceSummary"></div>
    <canvas id="attendanceChart" width="400" height="200"></canvas>
  </div>

  <!-- Notes -->
  <div class="section-card">
    <h3>Notes</h3>
    <div id="notesList"></div>
  </div>

  <!-- Tests / Assignments -->
  <div class="section-card">
    <h3>Tests / Assignments</h3>
    <div id="testList"></div>
    <canvas id="testChart" width="400" height="200"></canvas>
  </div>

  <!-- Notices -->
  <div class="section-card">
    <h3>Notices</h3>
    <div id="noticesList"></div>
  </div>

  <!-- Feedback -->
  <div class="section-card">
    <h3>Submit Feedback</h3>
    <label for="feedbackSubject">Subject</label>
    <input type="text" id="feedbackSubject">
    <textarea id="feedbackText" rows="3" placeholder="Write your feedback here..."></textarea>
    <button class="primary-btn" onclick="submitFeedback()">Send Feedback</button>
    <div id="feedbackResponses"></div>
  </div>

  <!-- Chatbot -->
  <div class="section-card">
    <h3>Chatbot Assistant</h3>
    <textarea id="chatInput" placeholder="Ask me anything..."></textarea>
    <button class="primary-btn" onclick="sendChat()">Send</button>
    <div id="chatResponses"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* Sample real-time data simulation */
let studentData = {
  attendance: [
    {subject:'Maths', percent:95},
    {subject:'Physics', percent:90},
    {subject:'Mechanics', percent:92}
  ],
  tests: [
    {subject:'Maths', score:85},
    {subject:'Physics', score:88},
    {subject:'Mechanics', score:90}
  ],
  notes:[
    "Chapter 5 summary by Mr. John Doe",
    "Lab instructions by Ms. Jane Smith"
  ],
  notices:[
    "Extra classes on Friday",
    "Submission deadline extended"
  ],
  feedback:[{subject:'Extra classes', response:'Scheduled on Friday'}]
};

/* Render Attendance */
const attendanceSummary = document.getElementById('attendanceSummary');
const attendanceChart = new Chart(document.getElementById('attendanceChart'), {
  type:'pie',
  data:{labels:[], datasets:[{data:[], backgroundColor:[]}]}
});
function renderAttendance(){
  attendanceSummary.innerHTML='';
  studentData.attendance.forEach(a=>{
    const div=document.createElement('div');
    div.textContent=`${a.subject} - ${a.percent}%`;
    attendanceSummary.appendChild(div);
  });
  attendanceChart.data.labels = studentData.attendance.map(a=>a.subject);
  attendanceChart.data.datasets[0].data = studentData.attendance.map(a=>a.percent);
  attendanceChart.data.datasets[0].backgroundColor = studentData.attendance.map((_,i)=>`hsl(${i*60%360},70%,50%)`);
  attendanceChart.update();
}

/* Render Tests */
const testList = document.getElementById('testList');
const testChart = new Chart(document.getElementById('testChart'), {
  type:'bar',
  data:{labels:[], datasets:[{label:'Scores', data:[], backgroundColor:'#2563eb'}]}
});
function renderTests(){
  testList.innerHTML='';
  studentData.tests.forEach(t=>{
    const div=document.createElement('div');
    div.textContent=`${t.subject} - ${t.score} marks`;
    testList.appendChild(div);
  });
  testChart.data.labels = studentData.tests.map(t=>t.subject);
  testChart.data.datasets[0].data = studentData.tests.map(t=>t.score);
  testChart.update();
}

/* Render Notes */
const notesList = document.getElementById('notesList');
function renderNotes(){
  notesList.innerHTML='';
  studentData.notes.forEach(n=>{
    const div=document.createElement('div');
    div.textContent=n;
    notesList.appendChild(div);
  });
}

/* Render Notices */
const noticesList = document.getElementById('noticesList');
function renderNotices(){
  noticesList.innerHTML='';
  studentData.notices.forEach(n=>{
    const div=document.createElement('div');
    div.textContent=n;
    noticesList.appendChild(div);
  });
}

/* Render Feedback */
const feedbackResponses = document.getElementById('feedbackResponses');
function renderFeedback(){
  feedbackResponses.innerHTML='';
  studentData.feedback.forEach(f=>{
    const div=document.createElement('div');
    div.textContent=`${f.subject}: ${f.response}`;
    feedbackResponses.appendChild(div);
  });
}

/* Feedback submission */
function submitFeedback(){
  const subj = document.getElementById('feedbackSubject').value;
  const text = document.getElementById('feedbackText').value;
  if(subj && text){
    studentData.feedback.push({subject:subj, response:text});
    renderFeedback();
    document.getElementById('feedbackSubject').value='';
    document.getElementById('feedbackText').value='';
  }
}

/* Chatbot triggers */
const chatbotTriggers = [
  {trigger:'hello', response:'Hello ðŸ‘‹, how can I help you?'},
  {trigger:'attendance', response:'You can check your attendance summary above.'},
  {trigger:'test', response:'Your test scores are displayed in the Tests / Assignments section.'}
];

function sendChat(){
  const input=document.getElementById('chatInput').value.trim().toLowerCase();
  if(!input) return;
  const chatResponses=document.getElementById('chatResponses');
  const userDiv=document.createElement('div');
  userDiv.textContent='You: '+input;
  userDiv.style.fontWeight='bold';
  chatResponses.appendChild(userDiv);
  const triggerObj=chatbotTriggers.find(t=>input.includes(t.trigger.toLowerCase()));
  const botDiv=document.createElement('div');
  botDiv.textContent='Bot: '+(triggerObj?triggerObj.response:'I didn\'t understand that. ðŸ¤”');
  botDiv.style.color='#2563eb';
  chatResponses.appendChild(botDiv);
  document.getElementById('chatInput').value='';
  chatResponses.scrollTop=chatResponses.scrollHeight;
}

/* Logout */
function logout(){ alert('Logging out...'); window.location.href='index.html'; }

/* Initial render */
renderAttendance();
renderTests();
renderNotes();
renderNotices();
renderFeedback();

/* Simulate real-time updates (Demo only) */
setInterval(()=>{
  // Example: Admin updated Math attendance
  studentData.attendance[0].percent = Math.min(studentData.attendance[0].percent +1,100);
  renderAttendance();
},10000); // every 10s
</script>
</body>
</html>
